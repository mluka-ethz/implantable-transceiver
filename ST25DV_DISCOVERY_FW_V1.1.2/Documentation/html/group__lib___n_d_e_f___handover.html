<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ST25DVDemo: NDEF Handover library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="st25_logo.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ST25DVDemo
   </div>
   <div id="projectbrief">Firmware for the ST25DV Demo</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">NDEF Handover library</div>  </div>
</div><!--header-->
<div class="contents">

<p>This module is used to manage the NDEF Handover messages, to negociate the switch to a non-nfc protocol of communication.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga9d3a6daa777f82fbc5827f15f9b983b9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga9d3a6daa777f82fbc5827f15f9b983b9">NDEF_AC_BUFFER_SIZE</a>&#160;&#160;&#160;(128)</td></tr>
<tr class="memdesc:ga9d3a6daa777f82fbc5827f15f9b983b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">SIze of the buffer used to store an Alternative Carrier (allocated on the stack).  <a href="#ga9d3a6daa777f82fbc5827f15f9b983b9">More...</a><br /></td></tr>
<tr class="separator:ga9d3a6daa777f82fbc5827f15f9b983b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0490b7230e0416f24388b2f82e13e7cc"><td class="memItemLeft" align="right" valign="top"><a id="ga0490b7230e0416f24388b2f82e13e7cc"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga0490b7230e0416f24388b2f82e13e7cc">NDEF_HANDOVER_SELECT_TYPE_STR</a>&#160;&#160;&#160;&quot;Hs&quot;</td></tr>
<tr class="memdesc:ga0490b7230e0416f24388b2f82e13e7cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Well-Known Type name for a Handover Select record. <br /></td></tr>
<tr class="separator:ga0490b7230e0416f24388b2f82e13e7cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaca05580aa6662c5761942ffda0db3f93"><td class="memItemLeft" align="right" valign="top"><a id="gaca05580aa6662c5761942ffda0db3f93"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gaca05580aa6662c5761942ffda0db3f93">NDEF_HANDOVER_REQUEST_TYPE_STR</a>&#160;&#160;&#160;&quot;Hr&quot;</td></tr>
<tr class="memdesc:gaca05580aa6662c5761942ffda0db3f93"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Well-Known Type name for a Handover Request record. <br /></td></tr>
<tr class="separator:gaca05580aa6662c5761942ffda0db3f93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga27705c6c6894ca2128a030d991bb41bb"><td class="memItemLeft" align="right" valign="top"><a id="ga27705c6c6894ca2128a030d991bb41bb"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga27705c6c6894ca2128a030d991bb41bb">NDEF_HANDOVER_SELECT_TYPE</a>&#160;&#160;&#160;0x4872</td></tr>
<tr class="memdesc:ga27705c6c6894ca2128a030d991bb41bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Well-Known Type name for a Handover Select Select (ascii value) <br /></td></tr>
<tr class="separator:ga27705c6c6894ca2128a030d991bb41bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab2ac7faf708dd9a51c23e307e9eb65bf"><td class="memItemLeft" align="right" valign="top"><a id="gab2ac7faf708dd9a51c23e307e9eb65bf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gab2ac7faf708dd9a51c23e307e9eb65bf">NDEF_HANDOVER_REQUEST_TYPE</a>&#160;&#160;&#160;0x4873</td></tr>
<tr class="memdesc:gab2ac7faf708dd9a51c23e307e9eb65bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Well-Known Type name for a Handover Request record (ascii value) <br /></td></tr>
<tr class="separator:gab2ac7faf708dd9a51c23e307e9eb65bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0226a7d2e406b33ef76a69505957ed7d"><td class="memItemLeft" align="right" valign="top"><a id="ga0226a7d2e406b33ef76a69505957ed7d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga0226a7d2e406b33ef76a69505957ed7d">NDEF_HANDOVER_VERSION_1_2</a>&#160;&#160;&#160;0x12</td></tr>
<tr class="memdesc:ga0226a7d2e406b33ef76a69505957ed7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Handover record implemented version. <br /></td></tr>
<tr class="separator:ga0226a7d2e406b33ef76a69505957ed7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab4d6ef0fbb595aee1c930aeefef989dd"><td class="memItemLeft" align="right" valign="top"><a id="gab4d6ef0fbb595aee1c930aeefef989dd"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gab4d6ef0fbb595aee1c930aeefef989dd">NDEF_HANDOVER_COLLISION_RESOLUTION_TYPE_STR</a>&#160;&#160;&#160;&quot;cr&quot;</td></tr>
<tr class="memdesc:gab4d6ef0fbb595aee1c930aeefef989dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Well-Known Type name for a Colision Resolution record. <br /></td></tr>
<tr class="separator:gab4d6ef0fbb595aee1c930aeefef989dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadab54e74084015900fd8929d7afe9542"><td class="memItemLeft" align="right" valign="top"><a id="gadab54e74084015900fd8929d7afe9542"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gadab54e74084015900fd8929d7afe9542">NDEF_HANDOVER_ALTERNATIVE_CARRIER_TYPE_STR</a>&#160;&#160;&#160;&quot;ac&quot;</td></tr>
<tr class="memdesc:gadab54e74084015900fd8929d7afe9542"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Well-Known Type name for an Alternative Carrier record. <br /></td></tr>
<tr class="separator:gadab54e74084015900fd8929d7afe9542"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab15bb220a1ae1a0098177d0ea9f425a2"><td class="memItemLeft" align="right" valign="top"><a id="gab15bb220a1ae1a0098177d0ea9f425a2"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gab15bb220a1ae1a0098177d0ea9f425a2">NDEF_HANDOVER_AC_CPS_MASK</a>&#160;&#160;&#160;(0x3)</td></tr>
<tr class="memdesc:gab15bb220a1ae1a0098177d0ea9f425a2"><td class="mdescLeft">&#160;</td><td class="mdescRight">NFC Forum Power States values mask. <br /></td></tr>
<tr class="separator:gab15bb220a1ae1a0098177d0ea9f425a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:gaec9c43c0b7f82d25296e0a70253f9c9c"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gaec9c43c0b7f82d25296e0a70253f9c9c">Ndef_Handover_ac_cps_t</a> { <a class="el" href="group__lib___n_d_e_f___handover.html#ggaec9c43c0b7f82d25296e0a70253f9c9ca80de57e7a1dac84bf57aee572b753b99">NDEF_HANDOVER_AC_CPS_INACTIVE</a> = 0x0, 
<a class="el" href="group__lib___n_d_e_f___handover.html#ggaec9c43c0b7f82d25296e0a70253f9c9cafe5bf7b3cc16bc1e2d34f371e8c4adb7">NDEF_HANDOVER_AC_CPS_ACTIVE</a> = 0x1, 
<a class="el" href="group__lib___n_d_e_f___handover.html#ggaec9c43c0b7f82d25296e0a70253f9c9caa03cbbd844087796edf8c48046755874">NDEF_HANDOVER_AC_CPS_ACTIVATING</a> = 0x2, 
<a class="el" href="group__lib___n_d_e_f___handover.html#ggaec9c43c0b7f82d25296e0a70253f9c9ca099b24a1cb972b6931cb6a2e1e7b8a78">NDEF_HANDOVER_AC_CPS_UNKNOWN</a> = 0x3
 }</td></tr>
<tr class="memdesc:gaec9c43c0b7f82d25296e0a70253f9c9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enumerates the NFC Forum Power States possible values.  <a href="group__lib___n_d_e_f___handover.html#gaec9c43c0b7f82d25296e0a70253f9c9c">More...</a><br /></td></tr>
<tr class="separator:gaec9c43c0b7f82d25296e0a70253f9c9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae51dbbe62da609ddb2726953343713ff"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gae51dbbe62da609ddb2726953343713ff">NDEF_ReadHandover</a> (<a class="el" href="structs_record_info.html">sRecordInfo_t</a> *pRecord, <a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a> *pHandover)</td></tr>
<tr class="memdesc:gae51dbbe62da609ddb2726953343713ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reads a record and retrieves the Handover information if present.  <a href="#gae51dbbe62da609ddb2726953343713ff">More...</a><br /></td></tr>
<tr class="separator:gae51dbbe62da609ddb2726953343713ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga37d2466e1ba52d18e5579603bbd5ef43"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga37d2466e1ba52d18e5579603bbd5ef43">NDEF_ReadAC</a> (uint8_t ac_nb, <a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a> *pHandover, <a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *pAC)</td></tr>
<tr class="memdesc:ga37d2466e1ba52d18e5579603bbd5ef43"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function reads the NDEF message and retrieves the nth Alternative Carrier record if present.  <a href="#ga37d2466e1ba52d18e5579603bbd5ef43">More...</a><br /></td></tr>
<tr class="separator:ga37d2466e1ba52d18e5579603bbd5ef43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad9de052fde4b9032155e94aaa3cf34e0"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gad9de052fde4b9032155e94aaa3cf34e0">NDEF_ReadAuxData</a> (uint8_t aux_data_nb, <a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *pAC, <a class="el" href="structs_record_info.html">sRecordInfo_t</a> *pRecord)</td></tr>
<tr class="memdesc:gad9de052fde4b9032155e94aaa3cf34e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function searches the NDEF message to retrieve the nth Auxiliary Data record if present.  <a href="#gad9de052fde4b9032155e94aaa3cf34e0">More...</a><br /></td></tr>
<tr class="separator:gad9de052fde4b9032155e94aaa3cf34e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8451e69e54c493a63ce9a726d381aba2"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga8451e69e54c493a63ce9a726d381aba2">NDEF_CreateHandover</a> (<a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a> *pHandover, <a class="el" href="structs_record_info.html">sRecordInfo_t</a> *pRecord)</td></tr>
<tr class="memdesc:ga8451e69e54c493a63ce9a726d381aba2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function prepares the Handover record with the data given in the Handover structure.  <a href="#ga8451e69e54c493a63ce9a726d381aba2">More...</a><br /></td></tr>
<tr class="separator:ga8451e69e54c493a63ce9a726d381aba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac4568910578a8d0df3be6ed599b75514"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#gac4568910578a8d0df3be6ed599b75514">NDEF_AddAlternativeCarrier</a> (<a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *pAC, char *CarrierDataRef, char **AuxDataRefID, <a class="el" href="structs_record_info.html">sRecordInfo_t</a> *pRecord)</td></tr>
<tr class="memdesc:gac4568910578a8d0df3be6ed599b75514"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function adds an Alternative Carrier record to a Handover record using the data given in the AC structure.  <a href="#gac4568910578a8d0df3be6ed599b75514">More...</a><br /></td></tr>
<tr class="separator:gac4568910578a8d0df3be6ed599b75514"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5635c7b9395bf77ea59f8d9edcb518e9"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga5635c7b9395bf77ea59f8d9edcb518e9">NDEF_WriteHandover</a> (<a class="el" href="structs_record_info.html">sRecordInfo_t</a> *pRecord, uint8_t *pNdef)</td></tr>
<tr class="memdesc:ga5635c7b9395bf77ea59f8d9edcb518e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function writes the Handover record into the memory.  <a href="#ga5635c7b9395bf77ea59f8d9edcb518e9">More...</a><br /></td></tr>
<tr class="separator:ga5635c7b9395bf77ea59f8d9edcb518e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga30b8d3d5bb01e58a592aebe504b0c130"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__lib___n_d_e_f___handover.html#ga30b8d3d5bb01e58a592aebe504b0c130">NDEF_GetACDataLength</a> (<a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *pAC, char *CarrierDataRef, char **AuxDataRefID)</td></tr>
<tr class="memdesc:ga30b8d3d5bb01e58a592aebe504b0c130"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns the length of an Alternative Carrier record data (excluding the record metadata).  <a href="#ga30b8d3d5bb01e58a592aebe504b0c130">More...</a><br /></td></tr>
<tr class="separator:ga30b8d3d5bb01e58a592aebe504b0c130"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>This module is used to manage the NDEF Handover messages, to negociate the switch to a non-nfc protocol of communication. </p>
<p>The NDEF Handover process is described by the NFC Forum Connection Handover specification. It consists in a specific NDEF message construct, as:</p><ul>
<li>NDEF 1st record: Handover Request or Handover Select record<ul>
<li>Version</li>
<li>Collision Resolution (nested record, optional)<ul>
<li>Random number</li>
</ul>
</li>
<li>Alternative Carrier 1 (nested record)<ul>
<li>Power state</li>
<li>Reference Data</li>
<li>Auxiliary Data Reference 1</li>
<li>...</li>
<li>Auxiliary Data Reference N</li>
</ul>
</li>
<li>...</li>
<li>Alternative Carrier N (nested record)</li>
</ul>
</li>
<li>NDEF record 2+: Alternative Carrier or Auxiliary Data: Connection details for one of the AC (record ID is the AC Reference Data or an Auxiliary Data Reference).</li>
<li>...</li>
<li>NDEF record N: Alternative Carrier or Auxiliary Data: Connection details for one of the AC (record ID is the AC Reference Data or an Auxiliary Data Reference). <hr/>
 </li>
</ul>
<h1><a class="anchor" id="Handover_Library_Usage"></a>
NDEF Handover Library usage:</h1>
<h2><a class="anchor" id="Static_Handover"></a>
Static Handover</h2>
<p>The Static Handover is used when a device is only equipped with a NFC Tag (no peer-to-peer) to directly propose a set of Alternative Carriers (ACs: bluetooth, wifi,...) without running the full handover request-select process.<br />
 The Handover Select record use in that case is similar to the one used during a regular Handover negociation.<br />
</p><ol type="1">
<li>Declare &amp; initialize an instance of <code><a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a></code>, such as: <pre class="fragment">Ndef_Handover_t wHandover = {.type = NDEF_HANDOVER_SELECT_TYPE, .version = NDEF_HANDOVER_VERSION_1_2};
</pre></li>
<li>Declare a <code>sRecordInfo_t</code> instance: <pre class="fragment">sRecordInfo_t HandoverRecord;
</pre></li>
<li>Call the <code>NDEF_CreateHandover</code> function, to start preparing the Handover Select record <pre class="fragment">NDEF_CreateHandover(&amp;wHandover,&amp;HandoverRecord);
</pre></li>
<li>Call the <code>NDEF_AddAlternativeCarrier</code> for each Alternative Carrier (such as Bluetooth, Wifi, ...)</li>
<li>Declare and initialize as many <code><a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a></code> instances as the number of non-NFC protocol available. And then call the <code>NDEF_AddAlternativeCarrier</code> for each of them. <pre class="fragment">Ndef_Handover_alternative_carrier_t wAC_BREDR = {.cps = NDEF_HANDOVER_AC_CPS_ACTIVE,
                                                 .aux_data_ref_count = 0};
Ndef_Handover_alternative_carrier_t wAC_BLE = {.cps = NDEF_HANDOVER_AC_CPS_ACTIVE,
                                               .aux_data_ref_count = 0};
Ndef_Handover_alternative_carrier_t wAC_Wifi = {.cps = NDEF_HANDOVER_AC_CPS_ACTIVE,
                                                .aux_data_ref_count = 0};

NDEF_AddAlternativeCarrier(&amp;wAC_BREDR,"urn:nfc:handover:bredr", NULL,&amp;HandoverRecord );
NDEF_AddAlternativeCarrier(&amp;wAC_BLE,"urn:nfc:handover:ble", NULL,&amp;HandoverRecord );
NDEF_AddAlternativeCarrier(&amp;wAC_Wifi,"urn:nfc:handover:wifi", NULL,&amp;HandoverRecord );
</pre> <dl class="section note"><dt>Note</dt><dd><ol type="a">
<li>In this example a single <code><a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a></code> could have been used, as the parameters are the same for all ACs.</li>
<li>If more than one NDEF record is required to provide the AC connection details, the <code>aux_data_ref_count</code> must specify the number of additional records. <pre class="fragment">Ndef_Handover_alternative_carrier_t wAC_Wifi = {.cps = NDEF_HANDOVER_AC_CPS_ACTIVE,
                                                .aux_data_ref_count = 2};
</pre> Then, it's required to initialize an array of pointers to these Auxiliary Data Reference, as: <pre class="fragment">char *aux_data_ref1 = "urn:nfc:handover:wifi:aux_data_ref1";
char *aux_data_ref2 = "urn:nfc:handover:wifi:aux_data_ref2";
char *wifi_aux_ref_data_array[2] = {aux_data_ref1,aux_data_ref2};
</pre> And then provide this array as the 3rd argument to the 'NDEF_AddAlternativeCarrier' function: <pre class="fragment">NDEF_AddAlternativeCarrier(&amp;wAC_Wifi,"urn:nfc:handover:wifi", wifi_aux_ref_data_array,&amp;HandoverRecord );
</pre></li>
</ol>
</dd></dl>
</li>
<li>Call the <code>NDEF_WriteHandover</code> function to finalize the NDEF message and write it to the tag. <pre class="fragment">NDEF_WriteHandover(&amp;HandoverRecord, NDEF_Buffer);
</pre></li>
<li>Then call other functions (from the libNDEF or not) to add records, describing the Alternative Carriers, to the NDEF message: <pre class="fragment">NDEF_AppendBluetoothOOB ( &amp;w_ble_oob, "urn:nfc:handover:ble" );
NDEF_AppendBluetoothOOB ( &amp;w_bredr_oob, "urn:nfc:handover:bredr" );
</pre> <dl class="section note"><dt>Note</dt><dd><ol type="a">
<li>The ID of these additional records (2nd argument in the above example) must match the Data Reference provided within the Handover record.</li>
<li>If Auxiliary Data References are expected they must also be added to the NDEF message, with their ID matching the ID provided to the Alternative Carrier record.</li>
</ol>
</dd></dl>
</li>
</ol>
<h1><a class="anchor" id="Reading_Handover"></a>
Reading through a Handover Request message</h1>
<ol type="1">
<li>Read the 1st record of the NDEF message: <pre class="fragment">sRecordInfo_t rRecord;
NDEF_ReadNDEF(NDEF_Buffer);
NDEF_IdentifyBuffer(rRecord,NDEF_Buffer);
</pre></li>
<li>Decode the handover: <pre class="fragment">Ndef_Handover_t rHandover;
NDEF_ReadHandover(&amp;rRecord ,  &amp;rHandover ); 
</pre></li>
<li>Read all Alternative Carrier records, and their Auxiliary Data References if any. <pre class="fragment">uint8_t ac_index, aux_index;
for(ac_index=0;ac_index&lt;rHandover.nb_alternative_carrier;ac_index++)
{
  Ndef_Handover_alternative_carrier_t rAC;
  NDEF_ReadAC( ac_index, &amp;rHandover  , &amp;rAC );
  for(aux_index = 0; aux_index &lt; rAC.aux_data_ref_count; aux_index++)
  {
    sRecordInfo_t AuxRecord;
    NDEF_ReadAuxData( aux_index, &amp;rAC, &amp;AuxRecord );
    // Do something with this Auxiliary Data
  }
  // Process this AC (Extract OOB/or whatever data), and decide if this Carrier is supported or not.
}
</pre></li>
<li>Choose the prefered Carrier and write a Handover Select record with the prefered AC as described in the <a class="el" href="group__lib___n_d_e_f___handover.html#Static_Handover">Static Handover</a> section. </li>
</ol>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga9d3a6daa777f82fbc5827f15f9b983b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9d3a6daa777f82fbc5827f15f9b983b9">&#9670;&nbsp;</a></span>NDEF_AC_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NDEF_AC_BUFFER_SIZE&#160;&#160;&#160;(128)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>SIze of the buffer used to store an Alternative Carrier (allocated on the stack). </p>
<p>128 bytes should be enough, the specification recommends to use short URIs as AC identifiers. </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="gaec9c43c0b7f82d25296e0a70253f9c9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaec9c43c0b7f82d25296e0a70253f9c9c">&#9670;&nbsp;</a></span>Ndef_Handover_ac_cps_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__lib___n_d_e_f___handover.html#gaec9c43c0b7f82d25296e0a70253f9c9c">Ndef_Handover_ac_cps_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enumerates the NFC Forum Power States possible values. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ggaec9c43c0b7f82d25296e0a70253f9c9ca80de57e7a1dac84bf57aee572b753b99"></a>NDEF_HANDOVER_AC_CPS_INACTIVE&#160;</td><td class="fielddoc"><p>The HW for this Alternative Carrier has to be switch on before proceeding. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggaec9c43c0b7f82d25296e0a70253f9c9cafe5bf7b3cc16bc1e2d34f371e8c4adb7"></a>NDEF_HANDOVER_AC_CPS_ACTIVE&#160;</td><td class="fielddoc"><p>The HW for this Alternative Carrier is currently running. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggaec9c43c0b7f82d25296e0a70253f9c9caa03cbbd844087796edf8c48046755874"></a>NDEF_HANDOVER_AC_CPS_ACTIVATING&#160;</td><td class="fielddoc"><p>The HW for this Alternative Carrier is being activated. </p>
</td></tr>
<tr><td class="fieldname"><a id="ggaec9c43c0b7f82d25296e0a70253f9c9ca099b24a1cb972b6931cb6a2e1e7b8a78"></a>NDEF_HANDOVER_AC_CPS_UNKNOWN&#160;</td><td class="fielddoc"><p>The HW for this Alternative Carrier is unknown. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gac4568910578a8d0df3be6ed599b75514"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac4568910578a8d0df3be6ed599b75514">&#9670;&nbsp;</a></span>NDEF_AddAlternativeCarrier()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t NDEF_AddAlternativeCarrier </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *&#160;</td>
          <td class="paramname"><em>pAC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>CarrierDataRef</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>AuxDataRefID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs_record_info.html">sRecordInfo_t</a> *&#160;</td>
          <td class="paramname"><em>pRecord</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function adds an Alternative Carrier record to a Handover record using the data given in the AC structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pAC</td><td>Pointer on input AC structure. </td></tr>
    <tr><td class="paramname">CarrierDataRef</td><td>String with the Alternative Carrier Data Reference (ID of the corresponding record in the NDEF message). </td></tr>
    <tr><td class="paramname">AuxDataRefID</td><td>Array with pointers to the Auxiliary Data References (as many as defined in pAC structure). </td></tr>
    <tr><td class="paramname">pRecord</td><td>Pointer on the Handover record to be filled with the AC data, must have been previously initialized with the NDEF_CreateHandover function. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NDEF_OK</td><td>The Handover record has been updated with AC information. </td></tr>
    <tr><td class="paramname">NDEF_ERROR</td><td>The Handover record cannot be updated with the AC information. </td></tr>
    <tr><td class="paramname">NDEF_ERROR_MEMORY_INTERNAL</td><td>The internal buffer for records is too small to add the AC information. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga8451e69e54c493a63ce9a726d381aba2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8451e69e54c493a63ce9a726d381aba2">&#9670;&nbsp;</a></span>NDEF_CreateHandover()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t NDEF_CreateHandover </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a> *&#160;</td>
          <td class="paramname"><em>pHandover</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs_record_info.html">sRecordInfo_t</a> *&#160;</td>
          <td class="paramname"><em>pRecord</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function prepares the Handover record with the data given in the Handover structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pHandover</td><td>Pointer on structure containing the handover basic information. </td></tr>
    <tr><td class="paramname">pRecord</td><td>Pointer used to return the prepared Handover record. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NDEF_OK</td><td>The record has been prepared. </td></tr>
    <tr><td class="paramname">NDEF_ERROR</td><td>The record has not been prepared. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga30b8d3d5bb01e58a592aebe504b0c130"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga30b8d3d5bb01e58a592aebe504b0c130">&#9670;&nbsp;</a></span>NDEF_GetACDataLength()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t NDEF_GetACDataLength </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *&#160;</td>
          <td class="paramname"><em>pAC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>CarrierDataRef</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>AuxDataRefID</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function returns the length of an Alternative Carrier record data (excluding the record metadata). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pAC</td><td>Pointer on the input AC structure. </td></tr>
    <tr><td class="paramname">CarrierDataRef</td><td>String with the Alternative Carrier Data Reference. </td></tr>
    <tr><td class="paramname">AuxDataRefID</td><td>Array with the Auxiliary Data References (as many as defined in the pAC structure). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The computed length in bytes corresponding to the provided Alternative Carrier information. </dd></dl>

</div>
</div>
<a id="ga37d2466e1ba52d18e5579603bbd5ef43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga37d2466e1ba52d18e5579603bbd5ef43">&#9670;&nbsp;</a></span>NDEF_ReadAC()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t NDEF_ReadAC </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>ac_nb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a> *&#160;</td>
          <td class="paramname"><em>pHandover</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *&#160;</td>
          <td class="paramname"><em>pAC</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function reads the NDEF message and retrieves the nth Alternative Carrier record if present. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ac_nb</td><td>Position of the Alternative Carrier Reference in the Handover record. </td></tr>
    <tr><td class="paramname">pHandover</td><td>Pointer to the Handover record where to find the AC Reference Data. </td></tr>
    <tr><td class="paramname">pAC</td><td>Pointer used to return the output Alternative Carrier record. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NDEF_OK</td><td>The Alternative Carrier record has been retrieved. </td></tr>
    <tr><td class="paramname">NDEF_ERROR</td><td>Not able to find the Alternative Carrier in the NDEF message. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gad9de052fde4b9032155e94aaa3cf34e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad9de052fde4b9032155e94aaa3cf34e0">&#9670;&nbsp;</a></span>NDEF_ReadAuxData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t NDEF_ReadAuxData </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>aux_data_nb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_ndef___handover__alternative__carrier__t.html">Ndef_Handover_alternative_carrier_t</a> *&#160;</td>
          <td class="paramname"><em>pAC</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structs_record_info.html">sRecordInfo_t</a> *&#160;</td>
          <td class="paramname"><em>pRecord</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function searches the NDEF message to retrieve the nth Auxiliary Data record if present. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">aux_data_nb</td><td>Position of the Auxiliary Data Reference in the Alternative Carrier. </td></tr>
    <tr><td class="paramname">pAC</td><td>Pointer on the Alternative Carrier structure where to find the Auxiliary Data Reference. </td></tr>
    <tr><td class="paramname">pRecord</td><td>Pointer to return the output Auxiliary Data record. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NDEF_OK</td><td>The Auxiliary Data record has been retrieved. </td></tr>
    <tr><td class="paramname">NDEF_ERROR</td><td>Not able to find the Auxiliary Data in the NDEF message. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="gae51dbbe62da609ddb2726953343713ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae51dbbe62da609ddb2726953343713ff">&#9670;&nbsp;</a></span>NDEF_ReadHandover()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t NDEF_ReadHandover </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs_record_info.html">sRecordInfo_t</a> *&#160;</td>
          <td class="paramname"><em>pRecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_ndef___handover__t.html">Ndef_Handover_t</a> *&#160;</td>
          <td class="paramname"><em>pHandover</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function reads a record and retrieves the Handover information if present. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pRecord</td><td>Pointer on the record structure to be read. </td></tr>
    <tr><td class="paramname">pHandover</td><td>Pointer used to return the Handover information. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NDEF_OK</td><td>Handover information has been retrieved from the record. </td></tr>
    <tr><td class="paramname">NDEF_ERROR</td><td>Not able to read the Handover information from the record. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga5635c7b9395bf77ea59f8d9edcb518e9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5635c7b9395bf77ea59f8d9edcb518e9">&#9670;&nbsp;</a></span>NDEF_WriteHandover()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t NDEF_WriteHandover </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structs_record_info.html">sRecordInfo_t</a> *&#160;</td>
          <td class="paramname"><em>pRecord</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pNdef</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function writes the Handover record into the memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pRecord</td><td>Pointer on the input Handover record. </td></tr>
    <tr><td class="paramname">pNdef</td><td>Pointer to a NDEF buffer (used to prepare the data before actual writing to the memory). </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NDEF_OK</td><td>The memory has been written. </td></tr>
    <tr><td class="paramname">NDEF_ERROR_MEMORY_INTERNAL</td><td>Cannot write to tag. </td></tr>
    <tr><td class="paramname">NDEF_ERROR_NOT_FORMATED</td><td>CCFile data not supported or not present. </td></tr>
    <tr><td class="paramname">NDEF_ERROR_MEMORY_TAG</td><td>Size not compatible with memory. </td></tr>
    <tr><td class="paramname">NDEF_ERROR_LOCKED</td><td>Tag locked, cannot be write. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
